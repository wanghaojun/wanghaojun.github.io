---
title: AOP-2021春招
date: 2021-04-07 16:38:48
tags: [Spring,面试，java]
---

AOP（Aspect Orient Programming），指面向方面（切面）编程，作为面向对象的一种补充， 用于处理系统中分布于各个模块的横切关注点，比如事务管理、日志、缓存等等。

<!--more-->

#### 应用场景

Authentication 权限 ，Caching 缓存 ，Context passing 内容传递 ，Error handling 错 误处理 ，Lazy loading 懒加载 ，Debugging 调试 ，logging, tracing, profiling and monitoring 记录跟踪 优化 校准，Performance optimization 性能优化 ，Persistence 持久化 ，Resource pooling 资源池 ，Synchronization 同步，Transactions 事务。

#### 原理

AOP 实现的关键在于 AOP 框架自动创建的 AOP 代理，AOP 代理主要分为静态代理和动态代理，静态代理的代表 为 AspectJ；而动态代理则以 Spring AOP 为代表。通常使用 AspectJ 的编译时增强实现 AOP， AspectJ 是静态代理的增强，所谓的静态代理就是 AOP 框架会在编译阶段生成 AOP 代理类，因此 也称为编译时增强。

Spring AOP 中的动态代理主要有两种方式，JDK 动态代理和 CGLIB 动态代理。JDK 动态代理 通过反射来接收被代理的类，并且要求被代理的类必须实现一个接口。JDK 动态代理的核心是 InvocationHandler 接口和 Proxy 类。

如果目标类没有实现接口，那么 Spring AOP 会选择使用 CGLIB 来动态代理目标类。CGLIB （Code Generation Library），是一个代码生成的类库，可以在运行时动态的生成某个类的子类， 注意，CGLIB 是通过继承的方式做的动态代理，因此如果某个类被标记为 final，那么它是无法 使用 CGLIB 做动态代理的。

#### 概念

a. **连接点（Joinpoint）**：程序执行的某个特定位置（如：某个方法调用前、调用后，方法 抛出异常后）。一个类或一段程序代码拥有一些具有边界性质的特定点，这些代码中的特定点就 是连接点。Spring 仅支持方法的连接点。

b. **切点（Pointcut）**：如果连接点相当于数据中的记录，那么切点相当于查询条件，一个切点 可以匹配多个连接点。Spring AOP 的规则解析引擎负责解析切点所设定的查询条件，找到对应的连接点。

c. **增强（Advice）**：增强是织入到目标类连接点上的一段程序代码。Spring 提供的增强接口都 是带方位名的，如：BeforeAdvice、AfterReturningAdvice、ThrowsAdvice 等。

d. **引介（Introduction）**：引介是一种特殊的增强，它为类添加一些属性和方法。这样，即使 一个业务类原本没有实现某个接口，通过引介功能，可以动态的未该业务类添加接口的实现逻辑， 让业务类成为这个接口的实现类。

e. **织入（Weaving）**：织入是将增强添加到目标类具体连接点上的过程，AOP 有三种织入方式： ①编译期织入：需要特殊的 Java 编译期（例如 AspectJ 的 ajc）；②装载期织入：要求使用特 殊的类加载器，在装载类的时候对类进行增强；③运行时织入：在运行时为目标类生成代理实现 增强。Spring 采用了动态代理的方式实现了运行时织入，而 AspectJ 采用了编译期织入和装载 期织入的方式。

 f. **切面（Aspect）**：切面是由切点和增强（引介）组成的，它包括了对横切关注功能的定义， 也包括了对连接点的定义。