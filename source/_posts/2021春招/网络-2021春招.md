---
title: 网络-2021春招
date: 2021-04-07 13:20:44
tags: [网络原理，面试]
---

OSI七层与TCP/IP五层网络架构、IPv4 & IPv6、TCP协议 三次握手四次挥手、HTTP、常见端口

<!--more-->

#### OSI七层与TCP/IP五层网络架构 

应用层: 文件传输，电子邮件，文件服务，虚拟终端 TFTP，HTTP，SNMP，FTP，SMTP，DNS，Telnet 

表示层:数据格式化，代码转换，数据加密 没有协议 

会话层: 解除或建立与别的接点的联系 没有协议 

传输层: 提供端对端的接口 TCP，UDP 

网络层: 传输数据包选择路由 IP，ICMP，RIP，OSPF，BGP，IGMP，ARP(IP->MAC)，RAPR ICMP协议主要用来检测网络通信故障和实现链路追踪，最典型的应用就是PING和tracerooute 

数据链路层: 传输数据帧 SLIP，CSLIP，PPP，ARP，RARP，MTU 

物理层: 二进制比特位的传输 ISO2110，IEEE802，IEEE802.2

#### IPv4 & IPv6

IPv4协议具有32位（4字节）地址长度；

点分十进制 内网地址分为A，B和C类

- A类地址范围：10.0.0.0 - 10.255.255.255 
- B类地址范围：172.16.0.0 - 172.31.255.255 
- C类地址范围：192.168.0.0 - 192.168.255.255 

IPv6协议具有128位（16字节）地址长度；冒分十六进制

#### TCP协议 三次握手四次挥手

数据格式：

![](http://img.wanghaojun.cn//other/20210329085717.png)

- seq：序列号，TCP把连接中发送的所有数据字节都编上一个序号，第一个字节的编号由本地随机产生；给字节编上序号后，就给每一个报文段指派一个序号；序列号seq就是这个报文段中的第一个字节的数据编号 
- ack：确认号，待收到对方下一个报文段的第一个数据字节的序号 
- 确认ACK标志位：ACK=1时，确认号字段才有效
- 同步SYN标志位：连接建立时用于同步序号。当SYN=1，ACK=0时表示连接请求报文段。若同意连接，则在响应报文段中使得SYN=1，ACK=1。SYN这个标志位只有在TCP建产连接时才会被置1，握手完成后SYN标志位被置0。 
- 终止FIN标志位：用来释放一个连接。FIN=1表示此报文段的发送方的数据已经发送完毕，并释放连接。
- URG：紧急指针有效 
- ACK：确认号有效 
- PSH：接收方应该尽快将这个报文段交给应用层 
- RST：重建连接 
- SYN：同步序号用来发起一个连接

三次握手：

![](http://img.wanghaojun.cn//other/20210329090114.png)

- 发送方: 打开SYN=1，自带序列号seq-x希望建立链接 
- 接收方：打开SYN=1，自带序列号seq-y。并且确认接收到了seq-x，并希望收到ack=seq-(x+1)，ACK=1时，ack才有效 
- 发送方：自带序列号seq-(x+1)。确认接收到了seq-y，并希望收到ack=seq-(y+1)，ACK=1时，ack才有效

四次挥手：

![](http://img.wanghaojun.cn//other/20210329090732.png)

- 发送方：FIN=1，自带序列号seq-u。进入FIN-WAIT-1（终止等待1）状态。FIN报文段即使不携带数据，也要消耗一个序号。 
- 接收方：自带序列号seq-v，确认接收到了seq-u, 并希望收到ack=seq-(u+1)，ACK=1时，ack才有效。服务端就入了CLOSE-WAIT（关闭等待）状态。发送方收到变为FIN-WAIT-2
- 接收方将数据发送完成 
- 接收方：FIN=1，自带序列号seq-w，确认接收到了seq-u, 并希望收到ack=seq-(u+1)，ACK=1时，ack才有效。变为LAST-ACK（最后确认）状态 
- 发送方：自带序列号seq-(u+1)，确认接收到了seq-w, 并希望收到ack=seq-(w+1)，ACK=1时，ack才有效。发送方变为TIME_WAIT状态

问题1: 为什么连接的时候是三次握手，关闭的时候却是四次握手？

因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。我收到了，你发数据吧

关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭，所以只能先回复一个ACK报文，告诉Client端，”你发的FIN报文我收到了”。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文+ACK。故需要四步握手。我收到了，等我发完数据，我关闭了

#### HTTP

> HTTP协议是超文本传输协议（默认端口80）

HTTP特点: 

- 无状态(无连接)：HTTP 是一个无状态协议，这意味着每个请求都是独立的。 
  - 请求时建连接、请求完释放连接，以尽快将资源释放出来服务其他客户端。但每次都要建立TCP请求，效率低 
  - Keep-Alive 被提出用来解决这效率低的问题。就是长连接。

http过程：

- 浏览器发送url-http请求，根据域名解析出IP（浏览器缓冲->本机->DNS服务器）
- 浏览器与WEB服务器建立TCP请求，发起http请求，解析那个路径下那个资源 
- WEB服务器响应HTTP请求，80端口，返回html代码 
- 浏览器解析html代码，关闭TCP连接

#### HTTPS

![](http://img.wanghaojun.cn//other/20210407192740.png)

1. client向server发送请求，然后连接到server的443端口，发送的信息主要是随机值1和客户端支持的加密算法。

2. server接收到信息之后给予client响应握手信息，包括随机值2和匹配好的协商加密算法，这个加密算法一定是client发送给server加密算法的子集。

3. 随即server给client发送第二个响应报文是数字证书。服务端必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面，这套证书其实就是一对公钥和私钥。传送证书，这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构，过期时间、服务端的公钥，第三方证书认证机构(CA)的签名，服务端的域名信息等内容。

4. 客户端解析证书，这部分工作是由客户端的TLS来完成的，首先会验证公钥是否有效，比如颁发机构，过期时间等等，如果发现异常，则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随即值（预主秘钥）。

5. 客户端认证证书通过之后，接下来是通过随机值1、随机值2和预主秘钥组装会话秘钥。然后通过证书的公钥加密会话秘钥。

6. 传送加密信息，这部分传送的是用证书加密后的会话秘钥，目的就是让服务端使用秘钥解密得到随机值1、随机值2和预主秘钥。

7. 服务端解密得到随机值1、随机值2和预主秘钥，然后组装会话秘钥，跟客户端会话秘钥相同。

8. 客户端通过会话秘钥加密一条消息发送给服务端，主要验证服务端是否正常接受客户端加密的消息。

9. 同样服务端也会通过会话秘钥加密一条消息回传给客户端，如果客户端能够正常接受的话表明SSL层连接建立完成了。

#### 常见端口

- 21端口：FTP 文件传输服务 
- 22端口：SSH 端口 
- 23端口：TELNET 终端仿真服务 
- 25端口：SMTP 简单邮件传输服务 
- 53端口：DNS 域名解析服务 
- 80端口：HTTP 超文本传输服务 
- 110端口：POP3 “邮局协议版本3”使用的端口 
- 443端口：HTTPS 加密的超文本传输服务 
- 3306端口：MYSQL 默认端口号

