---
title: 数据库基础
date: 2021-04-17 16:16:11
tags: [面试,数据库]
---

数据库事务、隔离级别、乐观锁和悲观锁

<!--more-->

#### 事务

- 原子性（ Atomicity ）: 事务是数据库的逻辑工作单位，不可分割，事务中包含的各操作要么都做，要么都不做 
- 一致性（ Consistency ）: 事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态
- 隔离性（ Isolation ）: 一个事务的执行不能其它事务干扰 
- 持续性（ Durability ）: 也称永久性，指一个事务一旦提交，它对数据库中的数据的改变就应该是永久性的，不能回滚

事务并发可能出现的情况

脏读：一个事务读到了另一个未提交事务修改过的数据 

不可重复读（Non-Repeatable Read）：一个事务只能读到另一个已经提交的事务修改过的数据，并且其他事务每对该数据进行一次修改并提交后，该事务都能查询得到最新值。

 幻读（Phantom）：一个事务先根据某些条件查询出一些记录，之后另一个事务又向表中插入了符合这些条件的记录，原先的事务再次按照该条件查询时，能把另一个事务插入的记录也读出来。

![](http://img.wanghaojun.cn//other/20210417162002.png)

#### 隔离级别

隔离级别比较：可串行化>可重复读>读已提交>读未提交 

- 读未提交: 事务A可以读取到事务B修改过但未提交的数据
  - 可能发生脏读、不可重复读和幻读问题 
- 读已提交: 事务B只能在事务A修改过并且已提交后才能读取到事务B修改的数据 
  - 解决了脏读的问题，但可能发生不可重复读和幻读问题 
- 可重复读: 在可重复读隔离级别下，事务B只能在事务A修改过数据并提交后，自己也提交事务后，才能读取到事务B修改的数据 
  - 解决了脏读和不可重复读的问题，但可能发生幻读问题
- 可串行化: 通过加锁实现（读锁和写锁）

![](http://img.wanghaojun.cn//other/20210417162158.png)

#### 乐观锁与悲观锁 

乐观锁比较适用于读多写少的情况(多读场景) 

悲观锁比较适用于写多读少的情况(多写场景) 

- 悲观锁: 悲观锁中的共享资源每次只给一个线程使用，其它线程阻塞，用完后再把资源转让给其它线程 
- 乐观锁: 很乐观，每次去拿数据的时候都认为别人不会修改。所以不会上锁，但是如果想要更新数据，则会在更新前检查在读取至更新这段时间别人有没有修改过这个数据。如果修改过，则重新读取，再次尝试更新，循环上述步骤直到更新成功（当然也允许更新失败的线程放弃操作）


